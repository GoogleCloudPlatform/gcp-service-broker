---
name: gcp-service-broker
icon_file: gcp_logo.png
label: Google Cloud Platform Service Broker
description: A service broker for Google Cloud Platform services
org: system

apply_open_security_group: true

migration: |
  properties['properties']['.properties.org']['value'] = 'system';
  if ('.properties.cloudsql_custom_plans' in properties['properties']){
      properties['properties']['.properties.cloudsql_mysql_custom_plans'] =
      {'value': properties['properties']['.properties.cloudsql_custom_plans']['value']};
  }

packages:
- name: gcp-service-broker
  type: app-broker
  manifest:
    buildpack: go_buildpack
    path: /tmp/gcp-service-broker.zip
    env:
      GOPACKAGENAME: github.com/GoogleCloudPlatform/gcp-service-broker
      GOVERSION: go1.10
      # You can override plans here.
  needs_cf_credentials: true
  enable_global_access_to_plans: true


# Uncomment this section if you want to display forms with configurable
# properties in Ops Manager. These properties will be passed to your
# applications as environment variables. You can also refer to them
# elsewhere in this template by using:
#     (( .properties.<property-name> ))
#
# The forms in this section are auto-generated. DO NOT edit them, instead change
# pkg/generator/forms.go to add/change properties and run:
# > gcp-service-broker generate forms
forms:
- name: root_service_account
  label: Root Service Account
  description: Please paste in the contents of the json keyfile (un-encoded) for your
    service account with owner credentials
  properties:
  - name: root_service_account_json
    type: text
    label: Root Service Account JSON
    configurable: true
- name: database_properties
  label: Database Properties
  description: Connection details for the backing database for the service broker
  properties:
  - name: db_host
    type: string
    label: Database host
    configurable: true
  - name: db_username
    type: string
    label: Database username
    configurable: true
    optional: true
  - name: db_password
    type: secret
    label: Database password
    configurable: true
    optional: true
  - name: db_port
    type: string
    default: "3306"
    label: Database port (defaults to 3306)
    configurable: true
  - name: db_name
    type: string
    default: servicebroker
    label: Database name
    configurable: true
  - name: ca_cert
    type: text
    label: Server CA cert
    configurable: true
    optional: true
  - name: client_cert
    type: text
    label: Client cert
    configurable: true
    optional: true
  - name: client_key
    type: text
    label: Client key
    configurable: true
    optional: true
- name: enable_disable
  label: Enable Services
  description: Enable or disable services
  properties:
  - name: gsb_service_google_bigquery_enabled
    type: boolean
    default: true
    label: Let the broker create and bind Google BigQuery instances
    configurable: true
  - name: gsb_service_google_bigtable_enabled
    type: boolean
    default: true
    label: Let the broker create and bind Google Bigtable instances
    configurable: true
  - name: gsb_service_google_cloudsql_mysql_enabled
    type: boolean
    default: true
    label: Let the broker create and bind Google CloudSQL MySQL instances
    configurable: true
  - name: gsb_service_google_cloudsql_postgres_enabled
    type: boolean
    default: true
    label: Let the broker create and bind Google CloudSQL PostgreSQL instances
    configurable: true
  - name: gsb_service_google_datastore_enabled
    type: boolean
    default: true
    label: Let the broker create and bind Google Cloud Datastore instances
    configurable: true
  - name: gsb_service_google_ml_apis_enabled
    type: boolean
    default: true
    label: Let the broker create and bind Google Machine Learning APIs instances
    configurable: true
  - name: gsb_service_google_pubsub_enabled
    type: boolean
    default: true
    label: Let the broker create and bind Google PubSub instances
    configurable: true
  - name: gsb_service_google_spanner_enabled
    type: boolean
    default: true
    label: Let the broker create and bind Google Spanner instances
    configurable: true
  - name: gsb_service_google_stackdriver_debugger_enabled
    type: boolean
    default: true
    label: Let the broker create and bind Stackdriver Debugger instances
    configurable: true
  - name: gsb_service_google_stackdriver_profiler_enabled
    type: boolean
    default: true
    label: Let the broker create and bind Stackdriver Profiler instances
    configurable: true
  - name: gsb_service_google_stackdriver_trace_enabled
    type: boolean
    default: true
    label: Let the broker create and bind Stackdriver Trace instances
    configurable: true
  - name: gsb_service_google_storage_enabled
    type: boolean
    default: true
    label: Let the broker create and bind Google Cloud Storage instances
    configurable: true
- name: role_whitelists
  label: Role Whitelisting
  description: Enable or disable role whitelisting
  properties:
  - name: gsb_service_google_bigquery_whitelist
    type: string
    default: bigquery.dataViewer,bigquery.dataEditor,bigquery.dataOwner,bigquery.user,bigquery.jobUser
    label: Role whitelist for Google BigQuery instances
    description: A comma delimited list of roles (minus the role/ prefix) that can
      be used when creating bound users for this service
    configurable: true
  - name: gsb_service_google_bigtable_whitelist
    type: string
    default: bigtable.user,bigtable.reader,bigtable.viewer
    label: Role whitelist for Google Bigtable instances
    description: A comma delimited list of roles (minus the role/ prefix) that can
      be used when creating bound users for this service
    configurable: true
  - name: gsb_service_google_cloudsql_mysql_whitelist
    type: string
    default: cloudsql.editor,cloudsql.viewer,cloudsql.client
    label: Role whitelist for Google CloudSQL MySQL instances
    description: A comma delimited list of roles (minus the role/ prefix) that can
      be used when creating bound users for this service
    configurable: true
  - name: gsb_service_google_cloudsql_postgres_whitelist
    type: string
    default: cloudsql.editor,cloudsql.viewer,cloudsql.client
    label: Role whitelist for Google CloudSQL PostgreSQL instances
    description: A comma delimited list of roles (minus the role/ prefix) that can
      be used when creating bound users for this service
    configurable: true
  - name: gsb_service_google_ml_apis_whitelist
    type: string
    default: ml.developer,ml.viewer,ml.modelOwner,ml.modelUser,ml.jobOwner,ml.operationOwner
    label: Role whitelist for Google Machine Learning APIs instances
    description: A comma delimited list of roles (minus the role/ prefix) that can
      be used when creating bound users for this service
    configurable: true
  - name: gsb_service_google_pubsub_whitelist
    type: string
    default: pubsub.publisher,pubsub.subscriber,pubsub.viewer,pubsub.editor
    label: Role whitelist for Google PubSub instances
    description: A comma delimited list of roles (minus the role/ prefix) that can
      be used when creating bound users for this service
    configurable: true
  - name: gsb_service_google_spanner_whitelist
    type: string
    default: spanner.databaseAdmin,spanner.databaseReader,spanner.databaseUser,spanner.viewer
    label: Role whitelist for Google Spanner instances
    description: A comma delimited list of roles (minus the role/ prefix) that can
      be used when creating bound users for this service
    configurable: true
  - name: gsb_service_google_storage_whitelist
    type: string
    default: storage.objectCreator,storage.objectViewer,storage.objectAdmin
    label: Role whitelist for Google Cloud Storage instances
    description: A comma delimited list of roles (minus the role/ prefix) that can
      be used when creating bound users for this service
    configurable: true
- name: compatibility
  label: Compatibility
  description: Legacy Compatibility Options
  properties:
  - name: gsb_compatibility_three_to_four_legacy_plans
    type: boolean
    default: false
    label: Compatibility with GCP Service Broker v3.X plans
    description: Enable compatibility with the GCP Service Broker v3.x. Before version
      4.0, each installation generated its own plan UUIDs, after 4.0 they have been
      standardized. This option installs a compatibility layer which checks if a service
      is using the correct plan GUID. If the service does not use the correct GUID,
      the request will fail with a message about how to upgrade.
    configurable: true
service_plan_forms:
- name: bigtable_custom_plans
  label: Google Bigtable Custom Plans
  description: Generate custom plans for Google Bigtable
  optional: true
  properties:
  - name: display_name
    type: string
    label: Display Name
    description: Display name
    configurable: true
  - name: description
    type: string
    label: Plan description
    description: Plan description
    configurable: true
  - name: service
    type: dropdown_select
    default: b8e19880-ac58-42ef-b033-f7cd9c94d1fe
    label: Service
    description: The service this plan is associated with
    options:
    - name: b8e19880-ac58-42ef-b033-f7cd9c94d1fe
      label: Google Bigtable
  - name: storage_type
    type: dropdown_select
    default: SSD
    label: Storage Type
    description: Either HDD or SSD (see https://cloud.google.com/bigtable/pricing
      for more information)
    configurable: true
    options:
    - name: SSD
      label: SSD - Solid-state Drive
    - name: HDD
      label: HDD - Hard Disk Drive
  - name: num_nodes
    type: string
    default: "3"
    label: Num Nodes
    description: Number of Nodes, Between 3 and 30 (see https://cloud.google.com/bigtable/pricing
      for more information)
    configurable: true
- name: cloudsql_mysql_custom_plans
  label: Google CloudSQL MySQL Custom Plans
  description: Generate custom plans for Google CloudSQL MySQL
  optional: true
  properties:
  - name: display_name
    type: string
    label: Display Name
    description: Display name
    configurable: true
  - name: description
    type: string
    label: Plan description
    description: Plan description
    configurable: true
  - name: service
    type: dropdown_select
    default: 4bc59b9a-8520-409f-85da-1c7552315863
    label: Service
    description: The service this plan is associated with
    options:
    - name: 4bc59b9a-8520-409f-85da-1c7552315863
      label: Google CloudSQL MySQL
  - name: tier
    type: string
    label: Tier
    description: Case-sensitive tier/machine type name (see https://cloud.google.com/sql/pricing
      for more information)
    configurable: true
  - name: pricing_plan
    type: dropdown_select
    default: PER_USE
    label: Pricing Plan
    description: Select a pricing plan (only for 1st generation instances)
    configurable: true
    options:
    - name: PER_USE
      label: Per-Use
    - name: PACKAGE
      label: Package
  - name: max_disk_size
    type: string
    default: "10"
    label: Max Disk Size
    description: Maximum disk size in GB (applicable only to Second Generation instances,
      10 minimum/default)
    configurable: true
- name: cloudsql_postgres_custom_plans
  label: Google CloudSQL PostgreSQL Custom Plans
  description: Generate custom plans for Google CloudSQL PostgreSQL
  optional: true
  properties:
  - name: display_name
    type: string
    label: Display Name
    description: Display name
    configurable: true
  - name: description
    type: string
    label: Plan description
    description: Plan description
    configurable: true
  - name: service
    type: dropdown_select
    default: cbad6d78-a73c-432d-b8ff-b219a17a803a
    label: Service
    description: The service this plan is associated with
    options:
    - name: cbad6d78-a73c-432d-b8ff-b219a17a803a
      label: Google CloudSQL PostgreSQL
  - name: tier
    type: string
    label: Tier
    description: A string of the form db-custom-[CPUS]-[MEMORY_MBS], where memory
      is at least 3840
    configurable: true
  - name: pricing_plan
    type: dropdown_select
    default: PER_USE
    label: Pricing Plan
    description: The pricing plan
    options:
    - name: PER_USE
      label: Per-Use
  - name: max_disk_size
    type: string
    default: "10"
    label: Max Disk Size
    description: Maximum disk size in GB (10 minimum/default)
    configurable: true
- name: spanner_custom_plans
  label: Google Spanner Custom Plans
  description: Generate custom plans for Google Spanner
  optional: true
  properties:
  - name: display_name
    type: string
    label: Display Name
    description: Display name
    configurable: true
  - name: description
    type: string
    label: Plan description
    description: Plan description
    configurable: true
  - name: service
    type: dropdown_select
    default: 51b3e27e-d323-49ce-8c5f-1211e6409e82
    label: Service
    description: The service this plan is associated with
    options:
    - name: 51b3e27e-d323-49ce-8c5f-1211e6409e82
      label: Google Spanner
  - name: num_nodes
    type: string
    default: "1"
    label: Num Nodes
    description: Number of Nodes, A minimum of 3 nodes is recommended for production
      environments. (see https://cloud.google.com/spanner/pricing for more information)
    configurable: true

