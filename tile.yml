# Copyright the Service Broker Project Authors. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# This file is AUTOGENERATED by ./gcp-service-broker generate, DO NOT EDIT IT.

---
name: gcp-service-broker
icon_file: gcp_logo.png
label: Google Cloud Platform Service Broker
description: 'A service broker for Google Cloud Platform services.'
product_version: "5.0.1"
org: system

stemcell_criteria:
  os: 'ubuntu-xenial'
  version: '170.82'

apply_open_security_group: true

migration: |
  {
  // migration: 0, Delete whitelist keys from 4.x
  delete properties.properties['.properties.gsb_service_google_bigquery_whitelist'];
  delete properties.properties['.properties.gsb_service_google_bigtable_whitelist'];
  delete properties.properties['.properties.gsb_service_google_cloudsql_mysql_whitelist'];
  delete properties.properties['.properties.gsb_service_google_cloudsql_postgres_whitelist'];
  delete properties.properties['.properties.gsb_service_google_ml_apis_whitelist'];
  delete properties.properties['.properties.gsb_service_google_pubsub_whitelist'];
  delete properties.properties['.properties.gsb_service_google_spanner_whitelist'];
  delete properties.properties['.properties.gsb_service_google_storage_whitelist'];
  
  }
  

packages:
- name: gcp-service-broker
  type: app-broker
  manifest:
    buildpack: go_buildpack
    path: /tmp/gcp-service-broker.zip
    env:
      GOPACKAGENAME: github.com/GoogleCloudPlatform/gcp-service-broker
      GOVERSION: go1.12
      # You can override plans here.
  needs_cf_credentials: true
  enable_global_access_to_plans: true


# Uncomment this section if you want to display forms with configurable
# properties in Ops Manager. These properties will be passed to your
# applications as environment variables. You can also refer to them
# elsewhere in this template by using:
#     (( .properties.<property-name> ))
forms:
- name: root_service_account
  label: Root Service Account
  description: Please paste in the contents of the json keyfile (un-encoded) for your
    service account with owner credentials.
  properties:
  - name: root_service_account_json
    type: text
    label: Root Service Account JSON
    configurable: true
- name: database_properties
  label: Database Properties
  description: Connection details for the backing database for the service broker.
  properties:
  - name: db_host
    type: string
    label: Database host
    configurable: true
  - name: db_username
    type: string
    label: Database username
    configurable: true
    optional: true
  - name: db_password
    type: secret
    label: Database password
    configurable: true
    optional: true
  - name: db_port
    type: string
    default: "3306"
    label: Database port (defaults to 3306)
    configurable: true
  - name: db_name
    type: string
    default: servicebroker
    label: Database name
    configurable: true
  - name: ca_cert
    type: text
    label: Server CA cert
    configurable: true
    optional: true
  - name: client_cert
    type: text
    label: Client cert
    configurable: true
    optional: true
  - name: client_key
    type: text
    label: Client key
    configurable: true
    optional: true
- name: brokerpaks
  label: Brokerpaks
  description: |-
    Brokerpaks are ways to extend the broker with custom services defined by Terraform templates.
    A brokerpak is an archive comprised of a versioned Terraform binary and providers for one or more platform, a manifest, one or more service definitions, and source code.
  properties:
  - name: gsb_brokerpak_config
    type: text
    default: '{}'
    label: Global Brokerpak Configuration
    description: A JSON map of configuration key/value pairs for all brokerpaks. If
      a variable isn't found in the specific brokerpak's configuration it's looked
      up here.
    configurable: true
- name: features
  label: Feature Flags
  description: Service broker feature flags.
  properties:
  - name: gsb_compatibility_enable_builtin_brokerpaks
    type: boolean
    default: "true"
    label: enable-builtin-brokerpaks
    description: Load brokerpaks that are built-in to the software.
    configurable: true
  - name: gsb_compatibility_enable_builtin_services
    type: boolean
    default: "true"
    label: enable-builtin-services
    description: Enable services that are built in to the broker i.e. not brokerpaks.
    configurable: true
  - name: gsb_compatibility_enable_catalog_schemas
    type: boolean
    default: "false"
    label: enable-catalog-schemas
    description: Enable generating JSONSchema for the service catalog.
    configurable: true
  - name: gsb_compatibility_enable_cf_sharing
    type: boolean
    default: "false"
    label: enable-cf-sharing
    description: Set all services to have the Sharable flag so they can be shared
      across spaces in PCF.
    configurable: true
  - name: gsb_compatibility_enable_eol_services
    type: boolean
    default: "false"
    label: enable-eol-services
    description: Enable broker services that are end of life.
    configurable: true
  - name: gsb_compatibility_enable_gcp_beta_services
    type: boolean
    default: "true"
    label: enable-gcp-beta-services
    description: Enable services that are in GCP Beta. These have no SLA or support
      policy.
    configurable: true
  - name: gsb_compatibility_enable_gcp_deprecated_services
    type: boolean
    default: "false"
    label: enable-gcp-deprecated-services
    description: Enable services that use deprecated GCP components.
    configurable: true
  - name: gsb_compatibility_enable_preview_services
    type: boolean
    default: "true"
    label: enable-preview-services
    description: Enable services that are new to the broker this release.
    configurable: true
  - name: gsb_compatibility_enable_terraform_services
    type: boolean
    default: "false"
    label: enable-terraform-services
    description: Enable services that use the experimental, unstable, Terraform back-end.
    configurable: true
  - name: gsb_compatibility_enable_unmaintained_services
    type: boolean
    default: "false"
    label: enable-unmaintained-services
    description: Enable broker services that are unmaintained.
    configurable: true
- name: default_override
  label: Default Overrides
  description: Override the default values your users get when provisioning.
  properties:
  - name: gsb_service_google_bigquery_provision_defaults
    type: text
    default: '{}'
    label: Provision default override Google BigQuery instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      provision property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_bigquery_bind_defaults
    type: text
    default: '{}'
    label: Bind default override Google BigQuery instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      bind property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_bigtable_provision_defaults
    type: text
    default: '{}'
    label: Provision default override Google Bigtable instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      provision property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_bigtable_bind_defaults
    type: text
    default: '{}'
    label: Bind default override Google Bigtable instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      bind property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_cloudsql_mysql_provision_defaults
    type: text
    default: '{}'
    label: Provision default override Google CloudSQL for MySQL instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      provision property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_cloudsql_mysql_bind_defaults
    type: text
    default: '{}'
    label: Bind default override Google CloudSQL for MySQL instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      bind property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_cloudsql_mysql_vpc_provision_defaults
    type: text
    default: '{}'
    label: Provision default override Google CloudSQL for MySQL instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      provision property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_cloudsql_mysql_vpc_bind_defaults
    type: text
    default: '{}'
    label: Bind default override Google CloudSQL for MySQL instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      bind property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_cloudsql_postgres_provision_defaults
    type: text
    default: '{}'
    label: Provision default override Google CloudSQL for PostgreSQL instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      provision property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_cloudsql_postgres_bind_defaults
    type: text
    default: '{}'
    label: Bind default override Google CloudSQL for PostgreSQL instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      bind property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_cloudsql_postgres_vpc_provision_defaults
    type: text
    default: '{}'
    label: Provision default override Google CloudSQL for PostgreSQL instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      provision property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_cloudsql_postgres_vpc_bind_defaults
    type: text
    default: '{}'
    label: Bind default override Google CloudSQL for PostgreSQL instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      bind property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_ml_apis_provision_defaults
    type: text
    default: '{}'
    label: Provision default override Google Machine Learning APIs instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      provision property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_ml_apis_bind_defaults
    type: text
    default: '{}'
    label: Bind default override Google Machine Learning APIs instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      bind property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_pubsub_provision_defaults
    type: text
    default: '{}'
    label: Provision default override Google PubSub instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      provision property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_pubsub_bind_defaults
    type: text
    default: '{}'
    label: Bind default override Google PubSub instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      bind property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_spanner_provision_defaults
    type: text
    default: '{}'
    label: Provision default override Google Spanner instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      provision property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_spanner_bind_defaults
    type: text
    default: '{}'
    label: Bind default override Google Spanner instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      bind property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_storage_provision_defaults
    type: text
    default: '{}'
    label: Provision default override Google Cloud Storage instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      provision property and values are the alternative default.
    configurable: true
  - name: gsb_service_google_storage_bind_defaults
    type: text
    default: '{}'
    label: Bind default override Google Cloud Storage instances.
    description: A JSON object with key/value pairs. Keys MUST be the name of a user-defined
      bind property and values are the alternative default.
    configurable: true
service_plan_forms:
- name: bigtable_custom_plans
  label: Google Bigtable Custom Plans
  description: Generate custom plans for Google Bigtable.
  optional: true
  properties:
  - name: display_name
    type: string
    label: Display Name
    description: Name of the plan to be displayed to users.
    configurable: true
  - name: description
    type: string
    label: Plan description
    description: The description of the plan shown to users.
    configurable: true
  - name: service
    type: dropdown_select
    default: b8e19880-ac58-42ef-b033-f7cd9c94d1fe
    label: Service
    description: The service this plan is associated with.
    configurable: true
    options:
    - name: b8e19880-ac58-42ef-b033-f7cd9c94d1fe
      label: Google Bigtable
  - name: storage_type
    type: dropdown_select
    default: SSD
    label: Storage Type
    description: 'Either HDD or SSD. See: https://cloud.google.com/bigtable/pricing
      for more information.'
    configurable: true
    options:
    - name: HDD
      label: HDD - Hard Disk Drive
    - name: SSD
      label: SSD - Solid-state Drive
  - name: num_nodes
    type: string
    default: "3"
    label: Num Nodes
    description: 'Number of nodes, between 3 and 30. See: https://cloud.google.com/bigtable/pricing
      for more information.'
    configurable: true
- name: cloudsql_mysql_custom_plans
  label: Google CloudSQL for MySQL Custom Plans
  description: Generate custom plans for Google CloudSQL for MySQL.
  optional: true
  properties:
  - name: display_name
    type: string
    label: Display Name
    description: Name of the plan to be displayed to users.
    configurable: true
  - name: description
    type: string
    label: Plan description
    description: The description of the plan shown to users.
    configurable: true
  - name: service
    type: dropdown_select
    default: 4bc59b9a-8520-409f-85da-1c7552315863
    label: Service
    description: The service this plan is associated with.
    configurable: true
    options:
    - name: 4bc59b9a-8520-409f-85da-1c7552315863
      label: Google CloudSQL for MySQL
  - name: tier
    type: string
    label: Tier
    description: The machine type the database will run on. MySQL has predefined tiers,
      other databases use the a string of the form db-custom-[CPUS]-[MEMORY_MBS],
      where memory is at least 3840.
    configurable: true
  - name: max_disk_size
    type: string
    default: "10"
    label: Max Disk Size
    description: Maximum disk size in GB, 10 is the minimum.
    configurable: true
- name: cloudsql_postgres_custom_plans
  label: Google CloudSQL for PostgreSQL Custom Plans
  description: Generate custom plans for Google CloudSQL for PostgreSQL.
  optional: true
  properties:
  - name: display_name
    type: string
    label: Display Name
    description: Name of the plan to be displayed to users.
    configurable: true
  - name: description
    type: string
    label: Plan description
    description: The description of the plan shown to users.
    configurable: true
  - name: service
    type: dropdown_select
    default: cbad6d78-a73c-432d-b8ff-b219a17a803a
    label: Service
    description: The service this plan is associated with.
    configurable: true
    options:
    - name: cbad6d78-a73c-432d-b8ff-b219a17a803a
      label: Google CloudSQL for PostgreSQL
  - name: tier
    type: string
    label: Tier
    description: The machine type the database will run on. MySQL has predefined tiers,
      other databases use the a string of the form db-custom-[CPUS]-[MEMORY_MBS],
      where memory is at least 3840.
    configurable: true
  - name: max_disk_size
    type: string
    default: "10"
    label: Max Disk Size
    description: Maximum disk size in GB, 10 is the minimum.
    configurable: true
- name: spanner_custom_plans
  label: Google Spanner Custom Plans
  description: Generate custom plans for Google Spanner.
  optional: true
  properties:
  - name: display_name
    type: string
    label: Display Name
    description: Name of the plan to be displayed to users.
    configurable: true
  - name: description
    type: string
    label: Plan description
    description: The description of the plan shown to users.
    configurable: true
  - name: service
    type: dropdown_select
    default: 51b3e27e-d323-49ce-8c5f-1211e6409e82
    label: Service
    description: The service this plan is associated with.
    configurable: true
    options:
    - name: 51b3e27e-d323-49ce-8c5f-1211e6409e82
      label: Google Spanner
  - name: num_nodes
    type: string
    default: "1"
    label: Num Nodes
    description: 'Number of nodes, a minimum of 3 nodes is recommended for production
      environments. See: https://cloud.google.com/spanner/pricing for more information.'
    configurable: true
- name: storage_custom_plans
  label: Google Cloud Storage Custom Plans
  description: Generate custom plans for Google Cloud Storage.
  optional: true
  properties:
  - name: display_name
    type: string
    label: Display Name
    description: Name of the plan to be displayed to users.
    configurable: true
  - name: description
    type: string
    label: Plan description
    description: The description of the plan shown to users.
    configurable: true
  - name: service
    type: dropdown_select
    default: b9e4332e-b42b-4680-bda5-ea1506797474
    label: Service
    description: The service this plan is associated with.
    configurable: true
    options:
    - name: b9e4332e-b42b-4680-bda5-ea1506797474
      label: Google Cloud Storage
  - name: storage_class
    type: string
    label: Storage Class
    description: 'The storage class of the bucket. See: https://cloud.google.com/storage/docs/storage-classes.'
    configurable: true
- name: gsb_brokerpak_sources
  label: Configure Brokerpaks
  description: Configure Brokerpaks
  optional: true
  properties:
  - name: uri
    type: string
    label: Brokerpak URI
    description: "The URI to load. Supported protocols are http, https, gs, and git.\n\t\t\t\tCloud
      Storage (gs) URIs follow the gs://<bucket>/<path> convention and will be read
      using the service broker service account.\n\n\t\t\t\tYou can validate the checksum
      of any file on download by appending a checksum query parameter to the URI in
      the format type:value.\n\t\t\t\tValid checksum types are md5, sha1, sha256 and
      sha512. e.g. gs://foo/bar.brokerpak?checksum=md5:3063a2c62e82ef8614eee6745a7b6b59"
    configurable: true
  - name: service_prefix
    type: string
    label: Service Prefix
    description: A prefix to prepend to every service name. This will be exact, so
      you may want to include a trailing dash.
    configurable: true
    optional: true
  - name: excluded_services
    type: text
    label: Excluded Services
    description: A list of UUIDs of services to exclude, one per line.
    configurable: true
    optional: true
  - name: config
    type: text
    default: '{}'
    label: Brokerpak Configuration
    description: A JSON map of configuration key/value pairs for the brokerpak. If
      a variable isn't found here, it's looked up in the global config.
    configurable: true
  - name: notes
    type: text
    label: Notes
    description: A place for your notes, not used by the broker.
    configurable: true
    optional: true
